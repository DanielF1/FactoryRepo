<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<title>Weinlager</title>

	<!-- JS dependencies -->
	<script type="text/javascript" src="//code.jquery.com/jquery-latest.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="../resources/js/bootstrap.min.js"></script>
	<script src="../resources/js/docs.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script th:inline="javascript" type="text/javascript">
    /*<![CDATA[*/

        // first one
        
		function test(data){
			var test = /*[[${production_management}]]*/ null;

			var options= {
			    //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
			    scaleBeginAtZero : true,

			    //Boolean - Whether grid lines are shown across the chart
			    scaleShowGridLines : true,

			    //String - Colour of the grid lines
			    scaleGridLineColor : "rgba(0,0,0,.05)",

			    //Number - Width of the grid lines
			    scaleGridLineWidth : 1,

			    //Boolean - Whether to show horizontal lines (except X axis)
			    scaleShowHorizontalLines: true,

			    //Boolean - Whether to show vertical lines (except Y axis)
			    scaleShowVerticalLines: true,

			    //Boolean - If there is a stroke on each bar
			    barShowStroke : true,

			    //Number - Pixel width of the bar stroke
			    barStrokeWidth : 2,

			    //Number - Spacing between each of the X value sets
			    barValueSpacing : 5,

			    //Number - Spacing between data sets within X values
			    barDatasetSpacing : 1,

			    //String - A legend template
			    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\">jvvbnvn<% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

			};
			
			var dateArray = [];
			var wine_amount_for_production = [];
			var wine_delivery_at_that_day = [];
			var wine_transport_at_that_day_in = [];
			var wine_transport_at_that_day_out = [];
			
			for (var i=0;i<test[0].production_a_day.length;i++) {
				dateArray.push(test[0].production_a_day[i].date.year + '-' + test[0].production_a_day[i].date.monthValue + '-' + test[0].production_a_day[i].date.dayOfMonth);	
				wine_amount_for_production.push(test[0].production_a_day[i].wine_amount_for_production);
				wine_delivery_at_that_day.push(test[0].production_a_day[i].wine_delivery_at_that_day);
				wine_transport_at_that_day_in.push(test[0].production_a_day[i].wine_transport_at_that_day_in);
				wine_transport_at_that_day_out.push(test[0].production_a_day[i].wine_transport_at_that_day_out);
				
			}

			var data = {
				    labels: dateArray,
				    datasets: [
				        {
				            label: "My First dataset",
				            fillColor: "rgba(60,186,215,0.5)",
				            strokeColor: "rgba(60,186,215,0.8)",
				            highlightFill: "rgba(60,186,215,0.75)",
				            highlightStroke: "rgba(60,186,215,1)",
				            data: wine_amount_for_production
				        },
				        {
				            label: "My Second dataset",
				            fillColor: "rgba(76,107,221,0.5)",
				            strokeColor: "rgba(76,107,221,0.8)",
				            highlightFill: "rgba(76,107,221,0.75)",
				            highlightStroke: "rgba(76,107,221,1)",
				            data: wine_delivery_at_that_day
				        },
				        {
				            label: "My Thrid dataset",
				            fillColor: "rgba(255,197,66,0.5)",
				            strokeColor: "rgba(255,197,66,0.8)",
				            highlightFill: "rgba(255,197,66,0.75)",
				            highlightStroke: "rgba(255,197,66,1)",
				            data: wine_transport_at_that_day_in
				        },
				        {
				            label: "My Forth dataset",
				            fillColor: "rgba(255,160,66,0.5)",
				            strokeColor: "rgba(255,160,66,0.8)",
				            highlightFill: "rgba(255,160,66,0.75)",
				            highlightStroke: "rgba(255,160,66,1)",
				            data: wine_transport_at_that_day_out
				        }
				    ]
				};

			var ctx = $("#myChart1").get(0).getContext("2d");
			var myBarChart = new Chart(ctx).Bar(data, options);
			
             
		}
	
    	// second one
    		function test2(data){
			var test = /*[[${production_management}]]*/ null;

			var options= {
			    //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
			    scaleBeginAtZero : true,

			    //Boolean - Whether grid lines are shown across the chart
			    scaleShowGridLines : true,

			    //String - Colour of the grid lines
			    scaleGridLineColor : "rgba(0,0,0,.05)",

			    //Number - Width of the grid lines
			    scaleGridLineWidth : 1,

			    //Boolean - Whether to show horizontal lines (except X axis)
			    scaleShowHorizontalLines: true,

			    //Boolean - Whether to show vertical lines (except Y axis)
			    scaleShowVerticalLines: true,

			    //Boolean - If there is a stroke on each bar
			    barShowStroke : true,

			    //Number - Pixel width of the bar stroke
			    barStrokeWidth : 2,

			    //Number - Spacing between each of the X value sets
			    barValueSpacing : 5,

			    //Number - Spacing between data sets within X values
			    barDatasetSpacing : 1,

			    //String - A legend template
			    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

			};
			
			var dateArray = [];
			var wine_amount_for_production = [];
			var wine_delivery_at_that_day = [];
			var wine_transport_at_that_day_in = [];
			var wine_transport_at_that_day_out = [];
			
			for (var i=0;i<test[1].production_a_day.length;i++) {
				dateArray.push(test[1].production_a_day[i].date.year + '-' + test[1].production_a_day[i].date.monthValue + '-' + test[1].production_a_day[i].date.dayOfMonth);	
				wine_amount_for_production.push(test[1].production_a_day[i].wine_amount_for_production);
				wine_delivery_at_that_day.push(test[1].production_a_day[i].wine_delivery_at_that_day);
				wine_transport_at_that_day_in.push(test[1].production_a_day[i].wine_transport_at_that_day_in);
				wine_transport_at_that_day_out.push(test[1].production_a_day[i].wine_transport_at_that_day_out);
				
			}

			var data = {
				    labels: dateArray,
				    datasets: [
					        {
					            label: "My First dataset",
					            fillColor: "rgba(60,186,215,0.5)",
					            strokeColor: "rgba(60,186,215,0.8)",
					            highlightFill: "rgba(60,186,215,0.75)",
					            highlightStroke: "rgba(60,186,215,1)",
					            data: wine_amount_for_production
					        },
					        {
					            label: "My Second dataset",
					            fillColor: "rgba(76,107,221,0.5)",
					            strokeColor: "rgba(76,107,221,0.8)",
					            highlightFill: "rgba(76,107,221,0.75)",
					            highlightStroke: "rgba(76,107,221,1)",
					            data: wine_delivery_at_that_day
					        },
					        {
					            label: "My Third dataset",
					            fillColor: "rgba(255,197,66,0.5)",
					            strokeColor: "rgba(255,197,66,0.8)",
					            highlightFill: "rgba(255,197,66,0.75)",
					            highlightStroke: "rgba(255,197,66,1)",
					            data: wine_transport_at_that_day_in
					        },
					        {
					            label: "My Forth dataset",
					            fillColor: "rgba(255,160,66,0.5)",
					            strokeColor: "rgba(255,160,66,0.8)",
					            highlightFill: "rgba(255,160,66,0.75)",
					            highlightStroke: "rgba(255,160,66,1)",
					            data: wine_transport_at_that_day_out
					        }
				    ]
				};

			var ctx = $("#myChart2").get(0).getContext("2d");
			var myBarChart = new Chart(ctx).Bar(data, options);    
		}
	/*]]>*/
	</script>
	
	<script type="text/javascript">
		$(document).ready(function() {
			$('[id^=chartButton-]').off("click").on("click", function() {
				var id = this.id.split('chartButton-');	
				$('#chart-container-' + id[1]).toggleClass('collapse');
			});
		});
	</script>
	
	
	<!-- CSS dependencies -->
	<link href="../resources/css/style.css" rel="stylesheet" />
	<style type="text/css">
	  .success_table{background-color:#92D36E!important; color:#fff;}
	  .btn-default{background-color:#92D36E!important; color:#fff;}
	  .wine_amount{width:170px; margin-right:10px; margin-left:10px;}
	  .diagramm{left:-120px;}
	  .location_name{}
 	  td{ 
 		    max-width: 100px; 
 		    overflow: hidden;
 		    text-overflow: ellipsis; 
 		    white-space: nowrap; 
 		}
	  .table_max{overflow: auto;}
	  .show_btn{width:100%;}
	  .btn_color_p{background-color:rgba(60,186,215,1); width:30px; height: 18px; margin-left:400px;}
	  .btn_color_w{background-color:rgba(76,107,221,1); width:30px; height: 18px; margin-left:540px; margin-top:-18px;}
	  .btn_color_i{background-color:rgba(255,197,66,1); width:30px; height: 18px; margin-left:700px; margin-top:-18px;}
	  .btn_color_e{background-color:rgba(255,160,66,1); width:30px; height: 18px; margin-left:800px; margin-top:-18px;}
	  .btn_color{margin-left:32px;}
	</style>

	<img src="../resources/img/wein.jpg" class="header"/>
</head>

<body>
	<div class="main-wrapper">
		<!-- Header -->
	
		<div class="col-lg-7"></div>
	
		<!-- Log in / Log out navigation -->
		<div class="col-lg-5 logNavi">	
			<nav th:include="login :: login"></nav>
		</div>
		<!-- Log in / Log out navigation -->
	
		<div class="col-lg-2"></div>
	
		<!-- navigation -->
		<div class="col-lg-8 navigation">
		<nav th:include="navigation :: navigation"></nav>
		</div>
		<!-- /navigation -->
	
		<div class="col-lg-2"></div>
	
		<div class="header">
			<div class="header-title">Cognac Fabrik <br/>Feuerwasser</div>
		</div>
		<!-- /Header -->
	
		<!-- Container -->
		<div class="main-container content">
			<div class="col-lg-12">
				<p class="btn-danger text-center" th:text="${error}"></p>
				<p class="btn-success text-center" th:text="${error_green}"></p>
			</div>
			<div class="col-lg-12">
				<h3 class="pull-left">Weinlager</h3>
				<div class="pull-right">
					<form th:method="post" th:action="@{/wineTransport}">	
						<select name="location_start">
							<option selected="disabled" style='display:none;'>Start</option>
							<option th:each="production : ${production_management}" th:value="${production.location_name}">
								<span th:text="${production.location_name}"></span>
							</option>
						</select>
						
						<select name="location_goal">
							<option value="" selected="disabled" style='display:none;'>Ziel</option>
							<option  th:each="production : ${production_management}" th:value="${production.location_name}">
								<span th:text="${production.location_name}"></span>
							</option>
						</select>
						
						<input class="text-center wine_amount" type="number" name="wine_amount" min="1" placeholder="Weinmenge in Liter"/>
						<button class="btn btn-default">Weintransport beantragen</button>
					</form>
				</div>
				
				
				<div class="col-lg-12"  th:each="production, it : ${production_management}" th:with="loc_count = ${it.count}">
					<div>
						<h4><span th:text="${production.location_name}"></span></h4>
					</div>

					<div class="table_max">
						<table class="table table-condensed dataTable" id="dataTable">
							<tr class="success_table">
								<td class="text-center">Datum</td>
								<td class="text-center" th:each="day : ${production.production_a_day}"><span th:text="${day.date}"></span></td>
							</tr>
							<tr>
								<td class="text-center">Verarbeitung</td>
								<td class="text-center" th:each="day : ${production.production_a_day}"><span th:text="${day.wine_amount_for_production}"></span></td>
							</tr>	
							<tr style="background-color:#F2F2F2">
								<td class="text-center">Weinlieferung</td>
								<td class="text-center" th:each="day : ${production.production_a_day}"><span th:text="${day.wine_delivery_at_that_day}"></span></td>
							</tr>	
							<tr class="">
								<td class="text-center">Wein Inport</td>
								<td class="text-center" th:each="day, it : ${production.production_a_day}" th:with="index = ${it.count}"><span th:text="${day.wine_transport_at_that_day_in}"></span></td>
							</tr>
							<tr class="" style="background-color:#F2F2F2">
								<td class="text-center">Wein Export</td>
								<td class="text-center" th:each="day, it : ${production.production_a_day}" th:with="index = ${it.count}"><span th:text="${day.wine_transport_at_that_day_out}"></span></td>
							</tr>
						</table>
					</div>
					
					<br/>
					
					<a th:id="chartButton- + ${loc_count}" data-toggle="collapse" class="btn btn-default show_btn" aria-expanded="false"
					   th:onclick="'test2(\''+${production.production_a_day} + '\'); test(\''+${production.production_a_day} + '\');'">
					   <span>Diagramm anzeigen</span>
					</a>
	
					<div class="collapse" th:id="chart-container- + ${loc_count}">
					  <div class="table_max">
					    <canvas th:id="myChart + ${loc_count}" width="4000" height="300px"></canvas>
					  </div>
					  
					  <br/>
					  
					    <div>
					    	<div class="text-center"><h4>Legende</h4></div>
				    		<div class="btn_color_p text-center"><span class="btn_color text-center"> Verarbeitung</span></div>
				    		<div class="btn_color_w text-center"><span class="btn_color text-center"> Weinanlieferung</span></div>
				    		<div class="btn_color_i text-center"><span class="btn_color text-center"> Inport</span></div>
				    		<div class="btn_color_e text-center"><span class="btn_color text-center"> Export</span></div>
					    </div>
					</div>
					<br/><br/>
				</div>
				
			</div>
		</div>
	</div>
	<!-- /Container -->
</body>
</html>